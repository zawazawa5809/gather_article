# 記事構成計画: LLMにdraw.io(XML)を書かせて爆速でシステム構成図、体制図、スイムレーン図等のITシステム開発で役立つ図を作るためのガイド

## 計画概要

- 作成日時: 2025-10-03T00:33:08+09:00
- 記事タイプ: article（技術解説記事）
- ターゲット読者: expert（エンジニア、技術リード、設計者）
- 目標文字数: 12000字
- リサーチ元: docs/research/research_2025-10-03_00-30-07.md

## タイトル案

- **案1（推奨）**: LLMでdraw.io XMLを書いてシステム図を爆速生成 - Claude 3.7 + IaC連携の完全ガイド
- 案2: draw.io図表自動生成の決定版 - LLMによるXMLプログラミング実践
- 案3: さらばGUI作図 - Claude 3.7 SonnetでAWS構成図・フロー図・組織図を自動化する技術

## 読者ペイン（困りごと）

1. **GUI作図の非効率性**: システム構成図やフロー図をマウスで作るのに何時間もかかる
2. **コードと図の乖離**: IaC（Terraform/CDK）で構築した実際のインフラと、手動メンテナンスの図表が常に不一致
3. **図表の標準化困難**: チーム内で作図スタイルがバラバラ、レビューに時間がかかる
4. **LLM生成図の品質不安**: ChatGPTやClaudeに図を作らせても座標がめちゃくちゃで編集不可能
5. **ドキュメント更新コスト**: 設計変更のたびに複数の図を手直しする労力

## 読者ゲイン（得られる価値）

1. **図表生成時間を90%削減**: プロンプト1回でAWS構成図、組織図、スイムレーンが完成
2. **IaC連携で自動同期**: TerraformコードからインフラがデプロイされるたびにClaude 3.7で構成図を再生成
3. **編集可能なXML出力**: draw.ioで微調整・カスタマイズが自由自在
4. **再現性の高いプロンプトテンプレート**: チーム内で共有すれば誰でも同じ品質の図を生成可能
5. **公式ドキュメント準拠**: mxGraph仕様に基づく正確なXML生成で長期運用に耐える

## 見出し構成

### 1. なぜ今「LLM × draw.io XML」なのか
- GUI作図の限界とコード化の必然性
- draw.ioがXMLベースである優位性（バージョン管理、自動生成、MCP連携）
- LLMの図表生成能力の進化（2025年時点での現実）

### 2. draw.io XMLの仕組み - mxGraphの基礎知識
#### 2.1 XML階層構造の全体像
- `<mxfile>` → `<diagram>` → `<mxGraphModel>` → `<root>` → `<mxCell>`
- id="0"とid="1"の予約セル
- vertex（図形）とedge（接続線）の違い

#### 2.2 座標系とレイアウト原則
- mxGeometry属性（x, y, width, height）の仕様
- vertexの絶対座標 vs edgeの相対座標
- relative属性の挙動（true/false）
- 推奨レイアウトパラメータ（垂直100px、水平200px、ページサイズ1169x827）

#### 2.3 スタイル属性の完全リファレンス
- fillColor, strokeColor, strokeWidth, fontSize
- gradientColor, fontColor, separatorColor
- スタイル文字列の記法（`rounded;strokeColor=red;fillColor=green`）
- mxConstantsで定義される全スタイル定数

#### 2.4 XMLの手動編集とデバッグ
- Extras > Edit Diagramでの直接編集
- 圧縮（deflate）の仕組みと非圧縮保存
- File > Export as > XMLでバージョン管理対応

### 3. LLM性能比較 - Claude 3.7 が最強である理由
#### 3.1 主要LLMの図表生成精度ベンチマーク
- Claude 3.7 Sonnet: AWS構成図の正確性・レイアウト品質
- Claude 3.5 Sonnet: 中程度の精度
- GPT-4 / GPT-4o: アイコン認識に課題
- その他モデル: 実用レベル未達

#### 3.2 Claude 3.7推奨の技術的根拠
- mxGraph XMLスキーマの学習精度
- 座標計算ロジックの安定性
- AWS/Azure等のアイコンライブラリ認識
- 生成時間と品質のトレードオフ（2分以内推奨）

### 4. 図表タイプ別実装ガイド
#### 4.1 AWS/Azureシステム構成図
- **プロンプトテンプレート**:
  ```
  draw.ioで使用できるXMLを書いて
  以下のTerraformコードで構築されたAWSインフラの構成図を作成してください。
  AWS 2025アイコンセットを使用し、水平レイアウトで配置してください。

  [Terraformコード]
  ```
- IaC連携ワークフロー（AWS CLI + CDK/Terraform → Claude 3.7 → draw.io）
- アイコンライブラリのカスタム登録（VSCode拡張機能活用）
- XMLサンプルコード（VPC/サブネット/EC2/RDS/LBの構成例）

#### 4.2 フローチャート・業務プロセス図
- **プロンプトテンプレート**:
  ```
  draw.ioで使えるXMLを書いて
  ECサイトの注文から発送までのフローチャートを作成してください。
  開始・処理・判断・終了の各ステップを明示し、垂直レイアウトで配置してください。
  ```
- ノード（vertex="1"）とエッジ（edge="1"）の定義
- 判断分岐（ダイヤモンド形状）の実装
- XMLサンプルコード（5ステップのフロー例）

#### 4.3 スイムレーン図（クロスファンクショナル図）
- **プロンプトテンプレート**:
  ```
  draw.ioで使えるXMLを書いて
  システム開発のスイムレーン図を作成してください。
  レーン: PM、開発、QA、インフラ
  フェーズ: 要件定義→設計→実装→テスト→デプロイ
  ```
- プールシェイプ（pool shapes）のコンテナ機能
- Arrange > Insert > Template > Flowcharts活用
- XMLサンプルコード（3レーン×4フェーズの例）

#### 4.4 組織図・体制図
- **プロンプトテンプレート**:
  ```
  draw.ioで使えるXMLを書いて
  以下の階層構造の組織図を作成してください。
  CEO → CTO, CFO, COO
  CTO → VP Engineering, VP Product
  VP Engineering → Backend Lead, Frontend Lead, SRE Lead
  ```
- テキスト/CSV自動生成（親 -> 子の記法）
- Arrange > Insert > Layout > Org Chartの自動整列
- XMLサンプルコード（3階層組織図）

#### 4.5 ER図・データモデル図
- **プロンプトテンプレート**:
  ```
  draw.ioでXMLを書いて
  顧客テーブル、商品テーブル、注文テーブルのER図を作成してください。
  顧客と注文は1対多、注文と商品は多対多の関係です。
  ```
- エンティティ（四角形）とリレーション（接続線）
- カーディナリティの表記（1:N, N:M）
- XMLサンプルコード（3テーブルのER図）

### 5. プロンプトエンジニアリング - 高品質生成の技法
#### 5.1 失敗防止テンプレート設計原則
- XML宣言とmxfile構造の必須要素
- id="0"とid="1"の予約（これを忘れると描画エラー）
- 全vertex要素へのgeometry定義
- 一貫したスタイル適用（色分け戦略）

#### 5.2 段階的生成アプローチ
- 単純構造 → プロセス重視 → 意思決定重視の順で複雑化
- 複雑な図は小分割して生成（2分ルール）
- 前のレイアウトをCtrl+Zでリセットしてから次を適用

#### 5.3 レイアウト最適化テクニック
- 垂直間隔: 100px（ノード間の読みやすさ）
- 水平間隔: 200px（グループ間の明確な分離）
- 中央配置基準: x=250-350（標準ページ内での視認性）
- フォントサイズ統一: 11px（draw.ioデフォルト）

#### 5.4 色分けとスタイル統一戦略
- 要素タイプ別の色コード例（サービス=#dae8fc, データベース=#d5e8d4, ネットワーク=#ffe6cc）
- グラデーション活用（fillColor → gradientColor）
- 企業ブランディング対応（カスタムカラーパレット）

### 6. 実務運用のベストプラクティス
#### 6.1 IaC連携の自動化ワークフロー
- CI/CDパイプラインへの組み込み（GitHub Actions例）
- Terraformデプロイ → AWS CLI情報抽出 → Claude API呼び出し → draw.io保存
- バージョン管理（Git diffで図の変更を追跡）

#### 6.2 手動編集との併用戦略
- LLM生成80% + 手動微調整20%の黄金比
- 「客先提出は要調整、内部共有なら十分」の判断基準
- draw.ioエディタでの最終チェック項目（接続線の整列、ラベル位置）

#### 6.3 チーム共有とテンプレート管理
- プロンプトライブラリのGit管理
- draw.io XMLテンプレート集の整備
- VSCode拡張機能（Draw.io Integration）の活用

#### 6.4 品質保証とレビュープロセス
- 生成図の検証項目（座標整合性、スタイル一貫性、情報正確性）
- Distribute機能での均等配置（水平/垂直）
- Snap to Grid / 自動整列の活用

### 7. トラブルシューティング
#### 7.1 よくあるエラーと解決策
| エラー | 原因 | 解決策 |
|-------|------|--------|
| 図が表示されない | id="0"/"1"の欠落 | mxCell id="0"とid="1" parent="0"を追加 |
| 座標がずれる | relative属性の誤用 | vertexはrelative="false"、edgeはrelative="true" |
| スタイルが反映されない | スタイル文字列の構文エラー | セミコロン区切りの形式を確認 |
| 生成時間が3分超 | プロンプトが過度に複雑 | 図を2-3個に分割して段階的生成 |
| AWSアイコンが認識されない | LLMモデルの限界 | Claude 3.7を使用、アイコンセット年を明示 |

#### 7.2 レイアウト崩れの修正手順
1. Extras > Edit DiagramでXMLを開く
2. `<mxGeometry>`要素のx, y値を確認
3. 垂直間隔100px、水平間隔200pxの原則で再配置
4. Arrange > Layout > Horizontalで自動整列試行

#### 7.3 パフォーマンス最適化
- XML圧縮の有効化（File > Properties > Compressed）
- 大規模図は複数ページに分割
- 不要なスタイル属性の削減

### 8. 発展的な活用シナリオ
#### 8.1 Claude APIとの自動化統合
- REST API経由での図表生成（Python/Node.jsサンプル）
- プロンプトのパラメータ化（Jinja2テンプレート）
- バッチ処理（複数IaCファイルから一括生成）

#### 8.2 他ツールとの連携
- PlantUML/Mermaid.jsからの移行パス
- PowerPoint/Google Slidesへの埋め込み
- Confluenceでのdraw.io図表管理

#### 8.3 今後の展望
- Claude 4.0以降での精度向上予測
- draw.io APIの進化（リアルタイムデータ連携）
- MCP（Model Context Protocol）によるツール統合

### 9. まとめ
- LLM × draw.io XMLは「作図の自動化」から「設計の自動化」へのパラダイムシフト
- Claude 3.7 Sonnet + IaC連携が2025年時点の最適解
- プロンプトエンジニアリング（失敗防止テンプレート・段階的生成・レイアウト原則）が成功の鍵
- 実務では生成80% + 手動調整20%の併用戦略が現実的
- チーム共有可能なテンプレートライブラリ整備で組織全体の生産性向上

## 執筆ガイドライン

### 文体
- である調（技術記事の標準）
- 専門用語は初出時に簡潔な定義を括弧で併記
- コードブロックには必ずファイル名またはコメントで文脈を明示

### 用語方針
- draw.io（diagrams.netとの併記は初出のみ）
- mxGraph（XMLベースライブラリとして説明）
- LLM（Large Language Model、初出時のみフル表記）
- IaC（Infrastructure as Code、初出時のみフル表記）
- AWS CDK / Terraform（具体的ツール名で記述）

### 図表方針
- 表: 比較、仕様一覧、エラー対処表に活用
- コードブロック: XMLサンプル、プロンプト例、CLIコマンド
- 画像: 極力避ける（本記事は「図を作る」記事なのでテキスト重視）

### 出典ルール
- 脚注`[n]`形式で本文中に番号挿入
- 末尾の「参考URL」セクションに`[n] タイトル — URL — 要旨（100字）`形式で列挙
- 一次情報（公式ドキュメント・論文）を優先引用

## キーメッセージ

1. **draw.io XMLの構造理解が全ての基盤** - mxGraphの階層（mxfile→diagram→mxGraphModel→root→mxCell）と座標系を押さえれば、LLMの出力品質が劇的に向上する
2. **Claude 3.7 Sonnetは2025年時点で最高精度** - AWS構成図でGPT-4を上回る正確性、mxGraph仕様の学習が優れている
3. **IaC連携で「図とコードの乖離」を解消** - Terraform/CDKのデプロイと同時に構成図を自動生成すれば、ドキュメント更新コストがゼロになる
4. **プロンプト設計が成否を分ける** - 失敗防止テンプレート、段階的生成、レイアウト原則（垂直100px/水平200px）の3点セットが必須
5. **実務では生成80% + 手動20%** - 完全自動化を目指さず、LLMで大枠を作り、draw.ioエディタで微調整する併用戦略が現実的

## 視覚的要素

### テーブル（表）

1. **LLM性能比較表**
   | モデル | AWS構成図精度 | 座標計算安定性 | アイコン認識 | 生成時間（平均） |
   |--------|--------------|---------------|-------------|----------------|
   | Claude 3.7 Sonnet | ★★★★★ | ★★★★★ | ★★★★★ | 90秒 |
   | Claude 3.5 Sonnet | ★★★★☆ | ★★★★☆ | ★★★★☆ | 80秒 |
   | GPT-4o | ★★★☆☆ | ★★★☆☆ | ★★☆☆☆ | 120秒 |
   | その他 | ★★☆☆☆ | ★★☆☆☆ | ★☆☆☆☆ | - |

2. **mxGeometry属性仕様表**
   | 要素タイプ | relative | x | y | width | height |
   |-----------|----------|---|---|-------|--------|
   | vertex（図形） | false | 絶対X座標（px） | 絶対Y座標（px） | 幅（px） | 高さ（px） |
   | edge（接続線） | true | -1～1（中心からの距離） | 垂直距離（px） | ラベル幅 | ラベル高さ |

3. **主要スタイル属性一覧**
   | 属性名 | 型 | 値の例 | 説明 |
   |--------|---|--------|------|
   | fillColor | string | #dae8fc, swimlane | 塗りつぶし色 |
   | strokeColor | string | #6c8ebf, red | 線の色 |
   | strokeWidth | float | 1.0, 2.5 | 線の太さ |
   | fontSize | int | 11, 14 | フォントサイズ |
   | fontColor | string | #000000, white | テキスト色 |
   | gradientColor | string | #7ea6e0 | グラデーション終点色 |

4. **推奨レイアウトパラメータ表**
   | パラメータ | 推奨値 | 理由 |
   |----------|--------|------|
   | 垂直方向間隔 | 100px | ノード間の読みやすさ確保 |
   | 水平方向間隔 | 200px | グループ間の明確な分離 |
   | ページサイズ | 1169x827 | A4横向き相当、印刷・共有に最適 |
   | 中央配置基準X | 250-350 | 標準ページ内での視認性 |
   | フォントサイズ | 11px | draw.ioデフォルト、可読性良好 |

5. **トラブルシューティング表**
   | エラー | 原因 | 解決策 |
   |-------|------|--------|
   | 図が表示されない | id="0"/"1"の欠落 | `<mxCell id="0"/>`, `<mxCell id="1" parent="0"/>`を追加 |
   | 座標がずれる | relative属性の誤用 | vertexは`relative="false"` |
   | スタイルが反映されない | 構文エラー | `key1=value1;key2=value2`形式を確認 |
   | 生成時間3分超 | プロンプト過度複雑 | 図を2-3個に分割 |
   | AWSアイコン認識失敗 | モデル限界 | Claude 3.7使用、年を明示（AWS 2025 icons） |

6. **実務シナリオ別プロンプトテンプレート表**
   | シナリオ | プロンプト骨子 | 出力例 |
   |---------|--------------|--------|
   | AWS構成図 | `draw.ioでXML作成。[Terraformコード]からAWS構成図、2025アイコン使用` | VPC/EC2/RDS/LBの構成 |
   | フローチャート | `draw.ioでXML作成。[業務プロセス]のフロー、垂直レイアウト` | 注文→決済→発送の5ステップ |
   | スイムレーン図 | `draw.ioでXML作成。レーン=[役割]、フェーズ=[工程]` | 開発/QA/インフラの3レーン |
   | 組織図 | `draw.ioでXML作成。階層=[役職関係]、自動整列` | CEO→CTO→各リード |
   | ER図 | `draw.ioでXML作成。テーブル=[エンティティ]、関係=[カーディナリティ]` | 顧客/商品/注文の3テーブル |

### コードブロック

1. **基本的なdraw.io XMLテンプレート**（2.1節）
2. **AWS構成図XMLサンプル**（4.1節、VPC/EC2/RDS/LB）
3. **フローチャートXMLサンプル**（4.2節、5ステップ）
4. **スイムレーン図XMLサンプル**（4.3節、3レーン×4フェーズ）
5. **組織図XMLサンプル**（4.4節、3階層）
6. **ER図XMLサンプル**（4.5節、3テーブル）
7. **プロンプトテンプレート集**（5.1節、失敗防止版）
8. **GitHub Actions統合例**（6.1節、Terraform→Claude API→draw.io）
9. **Python/Node.js API連携サンプル**（8.1節）

### 図（概念図）

- draw.io XML階層構造図（2.1節）
  - mxfile → diagram → mxGraphModel → root → mxCell の樹形図
  - 各要素の主要属性を注釈

### 画像

本記事では原則として画像を使用しない（図表生成をテーマとするため、テキストとコードで完結させる方針）。

## YAML フロントマター案

```yaml
---
permalink: /llm-drawio-xml-diagram-automation-guide
title: "LLMでdraw.io XMLを書いてシステム図を爆速生成 - Claude 3.7 + IaC連携の完全ガイド"
summary: "draw.ioのXML構造を理解し、Claude 3.7 Sonnetでシステム構成図・フロー図・組織図を自動生成する実践ガイド。Terraform/CDK連携、プロンプトテンプレート、トラブルシューティングまで網羅。"
tags:
  - "#draw-io"
  - "#llm"
  - "#claude-sonnet-3-7"
  - "#diagram-automation"
  - "#iac"
  - "#mxgraph"
  - "#aws-architecture"
  - "#prompt-engineering"
  - "#devops"
  - "#infrastructure-as-code"
---
```

## 品質チェック項目

- [x] CLAUDE.md 準拠（日本語、である調、UTF-8）
- [x] 構成の論理性（基礎→比較→実装→プロンプト→運用→トラブルシューティング→発展の流れ）
- [x] 出典設計（リサーチファイルの21件のソースを適切に引用）
- [x] 図表割当（表6個、コードブロック9個、概念図1個）
- [x] 目標文字数整合（12000字目標、構成から推定11000-13000字）
- [x] 読者価値の明示（ペイン5点、ゲイン5点）
- [x] キーメッセージの明確性（5点、技術的深さと実務性のバランス）
- [x] 専門用語の初出定義方針
- [x] 実践的なコード例の充実

## 構成品質スコア自己評価

### 評価項目（各20点満点）

1. **CLAUDE.md準拠**: 20/20
   - 日本語、である調、UTF-8、専門用語初出定義

2. **構成の論理性**: 19/20
   - 基礎→比較→実装→最適化→運用の自然な流れ
   - 9つのセクションが相互に補完
   - トラブルシューティングと発展的活用を最後に配置

3. **見出し階層の適切性**: 19/20
   - 最大3階層（# → ## → ###）を厳守
   - 各セクションの粒度が適切
   - 4.1-4.5の図表タイプ別が並列構造で明快

4. **図表割当の妥当性**: 20/20
   - 表6個（比較、仕様、パラメータ、トラブルシューティング等）
   - コードブロック9個（XMLサンプル、プロンプト、API連携）
   - 概念図1個（XML階層構造）
   - すべてが読者理解を助ける実用的なもの

5. **キーメッセージの明確性**: 20/20
   - 5つのキーメッセージが技術的深さと実務性を両立
   - リサーチで得られた知見を的確に反映
   - 読者の行動変容（導入検討→実装→運用）を促す内容

**総合スコア**: 98/100

**判定**: PASS（基準80点を大幅に上回る）

## 次フェーズへの引継ぎ

### IMPLEMENT フェーズへの指示

1. **執筆モード**: new（新規記事作成）
2. **品質レベル**: detailed（詳細執筆、コード例・表を充実）
3. **重点項目**:
   - 各図表タイプ（4.1-4.5）のXMLサンプルコードは動作検証済みの内容を記載
   - プロンプトテンプレートは実際にClaude 3.7で試して成功したものを優先
   - トラブルシューティング表は実際のエラーメッセージと解決策を具体的に
4. **文字数配分**:
   - 導入（1章）: 800字
   - 基礎（2章）: 2500字
   - LLM比較（3章）: 1200字
   - 実装ガイド（4章）: 3500字
   - プロンプトエンジニアリング（5章）: 1500字
   - 運用（6章）: 1200字
   - トラブルシューティング（7章）: 1000字
   - 発展（8章）: 800字
   - まとめ（9章）: 500字
   - **合計**: 約13000字

### リサーチファイル参照指示

- `docs/research/research_2025-10-03_00-30-07.md`の参考URL [1]-[21]を適切に引用
- 一次情報（公式ドキュメント）を優先的に脚注として使用
- 実装例はZenn/Qiita/DevelopersIOの記事を参考に具体化

## 最終出力

```
status: SUCCESS
next: IMPLEMENT
details: "article_plan_2025-10-03_00-33-08.md に保存。構成スコア 98/100 で基準80点を上回ったため、IMPLEMENTフェーズへ進行。"
quality_score: 98/100
pass_threshold: 80/100
plan_file: "docs/plan/article_plan_2025-10-03_00-33-08.md"
research_file: "docs/research/research_2025-10-03_00-30-07.md"
```
